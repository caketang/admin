(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{156:function(e,t,s){"use strict";s.r(t);var a=s(305),r=s(198),i={data:()=>({LANG:LANG,allChecked:!1,loading:!1,tableData:{},columnsUrl:"",tableUrl:"",baseUrl:"",sLoading:!1,tabOperation:[],assembleColumns:{index:4,data:[]},allData:{},query:{},userId:"",del_userId:"",games:[],modeData:{name:"",withdraw_per:""},rules:{name:[{required:!0,message:"请输入事件名称",trigger:"blur"}],withdraw_per:[{required:!0,message:"请输入打码量",trigger:"blur"}]},searchConfig:[{prop:"coupon_type",value:1,label:"状态",type:"select",list:[{label:"全部",value:0},{label:"有优惠",value:1},{label:"无优惠",value:2}]}],isEdit:{},labelWidth:"100px",formVisible:{state:!1}}),components:{tableDetail:a.a,formEdit:r.a},methods:{init(){let e=this,t=this.$route.query;null!==sessionStorage.del_userId||sessionStorage.del_userId,e.allChecked=!0,this.query={};for(let e in t)this.query[e]=t[e];-1==Object.keys(t).indexOf("user_name")&&delete this.query.user_name,-1==Object.keys(t).indexOf("memberAll")&&delete this.query.memberAll,new Promise((t,s)=>{0===e.assembleColumns.data.length?e.$.autoAjax("get",URL.api+"/games","",{ok:s=>{if(0===s.state&&s.data){let a=s.data;a.forEach(t=>{let s={label:t.game_name,type:"twoLine",game_id:t.game_id,game_type:t.game_type,filterByWord:"games",prop:"val",filterCondition:"game_type,game_id"};e.assembleColumns.data.push(s)}),t(a)}},p:()=>{},error:e=>{console.log(e)}}):t()}).then(()=>{e.columnsUrl="static/json/preAct/queryDetail/columns.json",e.queryUrl.apply(this)})},queryUrl(){let e=isNaN(this.query.game_id),t=[],s=[];e?(t=this.query.game_id.split(","),s=this.query.gameType.split(",")):(t.push(this.query.game_id),s.push(this.query.gameType));let a=[];t.forEach((e,t)=>{a.push({game_type:s[t],game_id:e})}),this.games=a,this.tableUrl=URL.api+`/active/rebetset/member?date_from=${this.query.date_from}&&date_to=${this.query.date_to}&&games=${JSON.stringify(a)}&&type=${this.query.type}&&coupon_type=1`,this.baseUrl=URL.api+`/active/rebetset/member?date_from=${this.query.date_from}&&date_to=${this.query.date_to}&&games=${JSON.stringify(a)}&&type=${this.query.type}`,this.query.user_name&&(this.tableUrl=this.tableUrl+`&&user_name=${this.query.user_name}`,this.baseUrl=this.baseUrl+`&&user_name=${this.query.user_name}`),this.query.level_id&&(this.tableUrl=this.tableUrl+`&&levels=${this.query.level_id}`,this.baseUrl=this.baseUrl+`&&levels=${this.query.level_id}`)},doHandle(e){switch(e.fn){case"doDetail":this.doDetail(e.row)}},doOperation(e){let t={};this.userId=e.rows.map(e=>e.user_id).join(","),void 0!==e.del_rows&&(this.del_userId=e.del_rows.map(e=>e.user_id).join(","),this.del_userId.split(",").map(e=>{t[e]=e}),sessionStorage.check_user=JSON.stringify(t))},nowUnChecked(e){this.sLoading=!0;let t=URL.api+"/active/rebetset/records",s=[];if(this.query.user_name&&e.rows)for(let t in e.rows)s[t]=e.rows[t].user_id;let a={start_time:this.query.date_from,end_time:this.query.date_to,name:e.modeData.name,withdraw_per:FORMATMultiplyMoney(e.modeData.withdraw_per),member_level:"全部"===this.query.memberAll?"0":this.query.level_id||"0",games:"全部"===this.query.gameAll?[]:this.games,user_id:s,excluded_user_id:e.dataList.length>0?e.dataList:[]};this.$.autoAjax("put",t,a,{ok:e=>{if(0===e.state&&e.data){let e=LANG["存入成功"]||"存入成功";this.$message.success(e),this.$router.push({path:"/discount"})}else this.$message.error(LANG["存入失败，请稍候重试"]||"存入失败，请稍候重试"),this.$router.push({path:"/discount"});this.sLoading=!1},p:()=>{},error:e=>{console.log(e)}})},goback(){this.$router.push({path:"/discountCondition"})},doQuery(e){this.tableUrl=this.baseUrl+`&&coupon_type=${e.item.coupon_type}`},resetForm(){this.tableUrl=this.baseUrl}},computed:{},mounted(){},activated(){this.init()},beforeRouteLeave(e,t,s){this.$refs.form&&this.$refs.form.resetFields(),s(!0)}},l=s(24);var o=function(e){s(447)},u=Object(l.a)(i,function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"clearfix",attrs:{id:"subAgentRebate"}},[s("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"space-between"}},[s("el-col",{attrs:{span:20}},[s("div",{staticClass:"title"},[s("a",{attrs:{href:"javascript:;"},on:{click:e.goback}},[s("el-button",{attrs:{type:"primary",icon:"arrow-left",size:"small"}},[e._v(e._s(e.LANG["返 回"]||"返 回"))])],1)]),e._v(" "),s("div",[s("p",{staticClass:"font14"},[e._v("当前查询条件：\n                    "),s("span",{staticClass:"pleft"},[e._v("日期："),s("el-tag",{attrs:{type:"gray"}},[e._v(e._s(e.query.date_from)+"至"+e._s(e.query.date_to))])],1),e._v(" "),s("span",{staticClass:"pleft"},[e._v("游戏平台："),s("el-tag",{attrs:{type:"gray"}},[e._v(e._s(e.query.gameAll))])],1),e._v(" "),e.query.memberAll?s("span",{staticClass:"pleft"},[e._v("会员层级："),s("el-tag",{attrs:{type:"gray"}},[e._v(e._s(e.query.memberAll))])],1):e._e(),e._v(" "),e.query.user_name?s("span",{staticClass:"pleft"},[e._v("会员名："),s("span",{staticClass:"membername",attrs:{type:"gray"}},[e._v(e._s(e.query.user_name))])]):e._e()])]),e._v(" "),s("div",[s("div",{staticClass:"fl w40"},[s("formEdit",{attrs:{formVisible:e.formVisible,formConfig:e.searchConfig,type:"search",labelWidth:e.labelWidth,isEdit:e.isEdit,showAdd:!1},on:{"do-query":e.doQuery,"reset-form":e.resetForm}})],1)])])],1),e._v(" "),s("el-col",[s("tableDetail",{attrs:{columnsUrl:e.columnsUrl,tableUrl:e.tableUrl,tableCheck:!0,tabOperation:e.tabOperation,tableIndex:!1,allCheck:!0,getData:!0,sumGame:!0,colspan:3,showAdd:!0,assembleColumns:e.assembleColumns},on:{unchecked:e.nowUnChecked}})],1)],1)},[],!1,o,"data-v-e4f15276",null);t.default=u.exports},447:function(e,t,s){}}]);