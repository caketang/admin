(window.webpackJsonp=window.webpackJsonp||[]).push([[91],{138:function(t,e,s){"use strict";s.r(e);var a=s(197),o=s(198),i=(s(13),{data:()=>({LANG:LANG,outUrl:"",dialogVisible:!1,applyInfoVisible:!1,dialog_show_edit:!1,show_edit_title:"",show_edit_coupon_money:"",from_edit_money:{coupon_money:""},dialog_widthdraw_edit:!1,show_withdraw_title:"",show_edit_withdraw_require:"",from_withdraw_money:{withdraw_money:""},applyInfo:{},columnsUrl:"",tableUrl:"",tabOperation:[{label:"批量通过",fn:"doAllAdopt"},{label:"批量拒绝",fn:"doAllRefuse"}],searchConfig:[{type:"dateGroup",label:"申请时间",prop:[{prop:"date_from",value:"",label:"开始时间"},{prop:"date_to",value:"",label:"结束时间"}]},{prop:"user_name",value:"",type:"text",label:"用户名"},{prop:"level",value:"",label:"会员等级",type:"select",list:[]},{prop:"active_title",value:"",label:"优惠活动标题",type:"select",list:[]},{prop:"status",value:"",label:"状态",type:"select",list:[{label:"未处理",value:"pending"},{label:"已通过",value:"pass"},{label:"已拒绝",value:"rejected"}]}],nowId:-1,isEdit:{},labelWidth:"100px",baseUrl:"",formVisible:{state:!1},formTitle:"备注",formType:"default",formLabelWidth:"60px",formConfig:[{prop:"remarks",value:"",label:"备注",type:"textarea",rules:[{require:!0}]}],selectedIds:[],editInfo:{},nowId:-1,updated:!1,sum:"",allData:{subTotalMoney:"",totalMoney:""},sumShow:!1,searchObj:{},isShow:"true"==sessionStorage.active_applys_export}),components:{tablegrid:a.a,formEdit:o.a},methods:{init(){this.columnsUrl="static/json/preAct/apply/columns.json",this.tableUrl=URL.api+ROUTES.GET.active.applys+"?date_from="+sessionStorage.sysTime+" 00:00:00&date_to="+sessionStorage.sysTime+" 23:59:59",this.baseUrl=URL.api+ROUTES.GET.active.applys,this.searchObj.date_from=sessionStorage.sysTime,this.searchObj.date_to=sessionStorage.sysTime,this.reqVips(),this.reqActTypes()},reqVips(){let t=URL.api+ROUTES.GET.user.levels;this.$.autoAjax("get",t,"",{ok:t=>{let e=t.data;for(let t in e)this.searchConfig[2].list.push({label:"VIP"+e[t].level,value:e[t].level})},p:()=>{},error:t=>{console.log(t)}}).catch(function(t){})},reqActTypes(){let t=URL.api+ROUTES.GET.actives.$+"?type=all";this.$.autoAjax("get",t,"",{ok:t=>{let e=t.data;for(let t in e)this.searchConfig[3].list.push({label:e[t].title,value:e[t].title})},p:()=>{},error:t=>{console.log(t)}}).catch(t=>{_this.$message.error(LANG["未知错误，请稍后重试！"]||"未知错误，请稍后重试！")})},doQuery(t){let e=t.item;this.tableUrl=this.baseUrl+this.addSearch(t.item);for(let t in e)this.searchObj[t]=e[t]},doHandle(t){switch(this.updated=!1,this.nowId=t.row.id||-1,t.fn){case"doAllow":this.submitAllow(t.row);break;case"doRefuse":this.submitRefuse(t.row);break;case"doViewInfo":this.doViewInfo(t.row);break;case"doWriteRemarks":this.doWriteRemarks(t.row);break;case"openUserSet":this.openUserSet(t.row);break;case"doShowEdit":this.doShowEdit(t.row);break;case"doEdit":this.doEdit(t.row)}},doOperation(t){switch(t.fn){case"doAllAdopt":this.doAllAdopt(t.rows);break;case"doAllRefuse":this.doAllRefuse(t.rows)}},doWriteRemarks(t){this.editInfo=t,this.formVisible.state=!0,this.formConfig[0].value=t.memo},dialog_close_edit(){this.dialog_show_edit=!1},dialog_close_withdraw(){this.dialog_widthdraw_edit=!1},doShowEdit(t){"pending"==t.status?(this.dialog_show_edit=!0,this.show_edit_title="修改用户："+t.user_name+"的优惠金额",this.show_edit_coupon_money=FORMATMONEY(t.coupon_money)):this.$message.error(LANG["已处理的不可修改优惠"]||"已处理的不可修改优惠")},doEdit(t){"pending"==t.status?(this.dialog_widthdraw_edit=!0,this.show_edit_title="修改用户："+t.user_name+"的取款条件你",this.show_edit_withdraw_require=FORMATMONEY(t.withdraw_require)):this.$message.error(LANG["已处理的不可修改取款条件"]||"已处理的不可修改取款条件")},doAllAdopt(t){let e=[];for(let s in t)e.push(parseInt(t[s].id));this.$.autoAjax("put",URL.api+ROUTES.PUT.active.apply.status,{id:e.toString(),status:"pass"},{ok:t=>{0===t.state&&t.data?this.$message.success(this.LANG["批量通过成功"]||"批量通过成功"):this.$message.error(this.LANG["批量通过失败，请稍后重试"]||"批量通过失败，请稍后重试"),this.updated=!0},p:()=>{},error:t=>{console.log(t)}}).catch(t=>{this.$message.error(LANG["未知错误，请稍后重试！"]||"未知错误，请稍后重试！")})},doAllRefuse(t){let e=[];for(let s in t)e.push(parseInt(t[s].id));this.$.autoAjax("put",URL.api+ROUTES.PUT.active.apply.status,{id:e.toString(),status:"rejected"},{ok:t=>{0===t.state&&t.data?this.$message.success(this.LANG["批量拒绝成功"]||"批量拒绝成功"):this.$message.error(this.LANG["批量拒绝失败，请稍后重试"]||"批量拒绝失败，请稍后重试"),this.updated=!0},p:()=>{},error:t=>{console.log(t)}}).catch(t=>{this.$message.error(LANG["未知错误，请稍后重试！"]||"未知错误，请稍后重试！")})},doViewInfo(t){let e=t.id;this.$.autoAjax("get",URL.api+ROUTES.GET.active.apply+"/"+e,"",{ok:t=>{0==t.state&&t.data&&(this.applyInfo=t.data[0]),this.applyInfoVisible=!0},p:()=>{},error:t=>{console.log(t)}}).catch(t=>{this.$message.error(LANG["未知错误，请稍后重试！"]||"未知错误，请稍后重试！")})},submitRemarks(t){let e=this.editInfo.id,s={content:""};s.content=t.formObj.remarks,this.$.autoAjax("put",URL.api+ROUTES.PUT.active.apply.comment+"/"+parseInt(e),s,{ok:t=>{0===t.state&&t.data?this.$message.success(this.LANG["提交成功"]||"提交成功"):this.$message.error(this.LANG["提交失败，请稍后重试"]||"提交失败，请稍后重试"),this.updated=!0},p:()=>{},error:t=>{console.log(t)}}).catch(t=>{this.$message.error(LANG["未知错误，请稍后重试！"]||"未知错误，请稍后重试！")})},submitAllow(t){this.$.autoAjax("put",URL.api+ROUTES.PUT.active.apply.status,{id:t.id,status:"pass",user_id:parseInt(t.user_id),user_name:t.user_name,memo:t.memo},{ok:t=>{0===t.state&&t.data?this.$message.success(this.LANG["通过成功"]||"通过成功"):this.$message.error(this.LANG["通过失败，请稍后重试"]||"通过失败，请稍后重试"),this.updated=!0},p:()=>{},error:t=>{console.log(t)}}).catch(t=>{this.$message.error(LANG["未知错误，请稍后重试！"]||"未知错误，请稍后重试！")})},submitRefuse(t){this.$.autoAjax("put",URL.api+ROUTES.PUT.active.apply.status,{id:t.id,status:"rejected",user_id:parseInt(t.user_id),user_name:t.user_name,memo:t.memo},{ok:t=>{0===t.state&&t.data?this.$message.success(this.LANG["拒绝成功"]||"拒绝成功"):this.$message.error(this.LANG["拒绝失败，请稍后重试"]||"拒绝失败，请稍后重试"),this.updated=!0},p:()=>{},error:t=>{console.log(t)}}).catch(t=>{this.$message.error(LANG["未知错误，请稍后重试！"]||"未知错误，请稍后重试！")})},resetForm(){this.tableUrl=this.baseUrl+"?date_from="+sessionStorage.sysTime+" 00:00:00&date_to="+sessionStorage.sysTime+" 23:59:59",this.searchObj.date_from=sessionStorage.sysTime,this.searchObj.date_to=sessionStorage.sysTime},getTableData(t){},saveDiscount(){let t=this,e={};this.updated=!1,this.$refs.from_edit_money.validate(s=>{s&&(e.coupon_money=FORMATMultiplyMoney(t.from_edit_money.coupon_money),t.dialog_show_edit=!1,t.from_edit_money.coupon_money="",this.$.autoAjax("patch",URL.api+"/active.discount/"+t.nowId,e,{ok:e=>{t.dialog_show_edit=!1,t.from_edit_money.coupon_money="",0===e.state&&e.data?(t.$message.success(LANG["恭喜您，优惠修改成功！"]||"恭喜您，优惠修改成功！"),t.updated=!0):2002===e.state?t.$message.error(LANG[e.msg]||e.msg):t.$message.error(LANG["未知错误，请稍候重试"]||"未知错误，请稍候重试")},p:()=>{},error:t=>{console.log(t)}}))})},saveWithdraw(){let t=this,e={};this.updated=!1,this.$refs.from_withdraw_money.validate(s=>{s&&(e.withdraw_require=FORMATMultiplyMoney(t.from_withdraw_money.withdraw_money),t.dialog_widthdraw_edit=!1,t.from_withdraw_money.withdraw_money="",this.$.autoAjax("patch",URL.api+"/active.withdraw.require/"+t.nowId,e,{ok:e=>{t.dialog_widthdraw_edit=!1,t.from_withdraw_money.withdraw_money="",0===e.state&&e.data?(t.$message.success(LANG["恭喜您，取款条件修改成功！"]||"恭喜您，取款条件修改成功！"),t.updated=!0):2002===e.state?t.$message.error(LANG[e.msg]||e.msg):t.$message.error(LANG["未知错误，请稍候重试"]||"未知错误，请稍候重试")},p:()=>{},error:t=>{console.log(t)}}))})},validatorNumber(t,e,s){e?/^[0-9]+(.[0-9]{1,2})?$/.test(e.toString().replace(/^\s+|\s+$/,""))?e<0?s(new Error(LANG["输入金额必需大于0"]||"输入金额必需大于0")):e>9999999?s(new Error(LANG["输入金额不能大于9999999"]||"输入金额不能大于9999999")):s():isNaN(e)||0==!!e.replace(/^\s+|\s+$/,"")?s(new Error(LANG["请输入数字值"]||"请输入数字值")):s(new Error(LANG["小数点后不超过两位"]||"小数点后不超过两位")):s(new Error(LANG["请输入数字值"]||"请输入数字值"))},exportData(){let t=this.$children[0].$refs.editForm.model,e=this;if(t.date_from&&t.date_to){let t=URL.api+"/export/download/active/applys";this.$.autoAjax("get",URL.api+"/dev/download/sign?nonce="+t,"",{ok:s=>{s.data?(e.outUrl=t+e.addSearch(e.searchObj)+"&nonce="+s.data.nonce+"&signature="+s.data.signature+"&time="+s.data.time+"&uuid="+s.data.uuid,e.dialogVisible=!0):s.msg?this.$message.error(s.msg):e.$message.error(LANG["数据导出失败，请稍后重试"]||"数据导出失败，请稍后重试")},p:()=>{},error:t=>{console.log(t)}}).catch(t=>{})}else this.$message.error(LANG["必需选择时间才能导出"]||"必需选择时间才能导出")}},computed:{},mounted(){},created(){this.init()}}),r=s(24);var l=function(t){s(426)},d=Object(r.a)(i,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"w100",attrs:{id:"act_apply"}},[s("formEdit",{attrs:{formVisible:t.formVisible,formConfig:t.searchConfig,type:"search",labelWidth:t.labelWidth,isEdit:t.isEdit,showAdd:!1},on:{"do-query":t.doQuery,"reset-form":t.resetForm}}),t._v(" "),s("el-col",[s("tablegrid",{attrs:{columnsUrl:t.columnsUrl,tableUrl:t.tableUrl,pageSet:!0,tableIndex:!1,tabOperation:t.tabOperation,getData:!0,showRefresh:!1,autoshowRefresh:!0,showExport:t.isShow,updated:t.updated},on:{"do-operation":t.doOperation,"get-table-data":t.getTableData,"do-handle":t.doHandle,"export-data":t.exportData}},[t.sumShow?s("tr",{staticClass:"sumdiv ml20",attrs:{slot:"other",span:12},slot:"other"}):t._e()])],1),t._v(" "),s("el-col",[s("formEdit",{attrs:{formTitel:t.formTitle,formVisible:t.formVisible,formConfig:t.formConfig,type:t.formType,labelWidth:t.formLabelWidth,isEdit:t.isEdit,formType:t.formType},on:{"get-form":t.submitRemarks}})],1),t._v(" "),s("el-col",[s("el-dialog",{attrs:{title:"提示",visible:t.dialogVisible,size:"tiny"},on:{"update:visible":function(e){t.dialogVisible=e}}},[t._v("\n              "+t._s(t.LANG["点击”确认“导出数据"]||"点击”确认“导出数据")+"\n              "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),s("a",{attrs:{href:t.outUrl,target:"_blank",id:"outUrl"}},[s("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("确 认")])],1)],1)])],1),t._v(" "),s("el-col",[s("el-dialog",{staticClass:"dialog-apply-info",attrs:{title:t.LANG["申请详情"]||"申请详情",size:"tiny"},model:{value:t.applyInfoVisible,callback:function(e){t.applyInfoVisible=e},expression:"applyInfoVisible"}},[s("el-row",{staticClass:"lineDialog",attrs:{gutter:20}},[s("el-col",{attrs:{span:6}},[s("div",{staticClass:"grid-content bg-purple tRight"},[s("span",[t._v(t._s(t.LANG["用户名称"]||"用户名称")+"：")])])]),t._v(" "),s("el-col",{attrs:{span:18}},[s("div",{staticClass:"grid-content bg-purple-light"},[s("span",[t._v(t._s(t.applyInfo.user_name))])])]),t._v(" "),s("el-col",{staticClass:"mt10",attrs:{span:6}},[s("div",{staticClass:"grid-content bg-purple tRight"},[s("span",[t._v(t._s(t.LANG["联系电话"]||"联系电话")+"：")])])]),t._v(" "),s("el-col",{staticClass:"mt10",attrs:{span:18}},[s("div",{staticClass:"grid-content bg-purple-light"},[s("span",[t._v(t._s(t.applyInfo.mobile))])])]),t._v(" "),s("el-col",{staticClass:"mt10",attrs:{span:6}},[s("div",{staticClass:"grid-content bg-purple tRight"},[s("span",[t._v(t._s(t.LANG["邮箱"]||"邮箱")+"：")])])]),t._v(" "),s("el-col",{staticClass:"mt10",attrs:{span:18}},[s("div",{staticClass:"grid-content bg-purple-light"},[s("span",[t._v(t._s(t.applyInfo.email))])])]),t._v(" "),s("el-col",{staticClass:"mt10",attrs:{span:6}},[s("div",{staticClass:"grid-content bg-purple tRight"},[s("span",[t._v(t._s(t.LANG["申请活动"]||"申请活动")+"：")])])]),t._v(" "),s("el-col",{staticClass:"mt10",attrs:{span:18}},[s("div",{staticClass:"grid-content bg-purple-light"},[s("span",[t._v(t._s(t.applyInfo.active_name))])])]),t._v(" "),s("el-col",{staticClass:"mt10",attrs:{span:6}},[s("div",{staticClass:"grid-content bg-purple tRight"},[s("span",[t._v(t._s(t.LANG["申请内容"]||"申请内容")+"：")])])]),t._v(" "),s("el-col",{staticClass:"mt10",attrs:{span:18}},[s("div",{staticClass:"grid-content bg-purple-light"},[s("span",[t._v(t._s(t.applyInfo.content))])])])],1),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.applyInfoVisible=!1}}},[t._v(t._s(t.LANG["关闭"]||"关闭"))])],1)],1)],1),t._v(" "),s("el-col",[s("el-dialog",{attrs:{title:t.show_edit_title,visible:t.dialog_show_edit,width:"'120px'",size:"tiny","before-close":t.dialog_close_edit,center:""},on:{"update:visible":function(e){t.dialog_show_edit=e}}},[s("span",{staticClass:"tCent w100"},[t._v(t._s(t.LANG["原优惠金额"]||"原优惠金额")+" ："+t._s(t.show_edit_coupon_money))]),t._v(" "),s("p",{staticClass:"mt10"},[s("el-form",{ref:"from_edit_money",attrs:{model:t.from_edit_money,"label-width":"100px"}},[s("el-form-item",{attrs:{label:t.LANG["现优惠金额"]||"现优惠金额:",rules:[{validator:t.validatorNumber,trigger:"blur"}],prop:"coupon_money"}},[s("el-input",{staticClass:"intW",model:{value:t.from_edit_money.coupon_money,callback:function(e){t.$set(t.from_edit_money,"coupon_money",e)},expression:"from_edit_money.coupon_money"}})],1)],1)],1),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialog_show_edit=!1}}},[t._v("取 消")]),t._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:t.saveDiscount}},[t._v("修 改")])],1)])],1),t._v(" "),s("el-col",[s("el-dialog",{attrs:{title:t.show_withdraw_title,visible:t.dialog_widthdraw_edit,width:"'120px'",size:"tiny","before-close":t.dialog_close_withdraw,center:""},on:{"update:visible":function(e){t.dialog_widthdraw_edit=e}}},[s("span",{staticClass:"tCent w100"},[t._v(t._s(t.LANG["原取款条件"]||"原取款条件")+" ："+t._s(t.show_edit_withdraw_require))]),t._v(" "),s("p",{staticClass:"mt10"},[s("el-form",{ref:"from_withdraw_money",attrs:{model:t.from_withdraw_money,"label-width":"100px"}},[s("el-form-item",{attrs:{label:t.LANG["取款条件"]||"取款条件:",rules:[{validator:t.validatorNumber,trigger:"blur"}],prop:"withdraw_money"}},[s("el-input",{staticClass:"intW",model:{value:t.from_withdraw_money.withdraw_money,callback:function(e){t.$set(t.from_withdraw_money,"withdraw_money",e)},expression:"from_withdraw_money.withdraw_money"}})],1)],1)],1),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialog_widthdraw_edit=!1}}},[t._v("取 消")]),t._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:t.saveWithdraw}},[t._v("修 改")])],1)])],1)],1)},[],!1,l,null,null);e.default=d.exports},426:function(t,e,s){}}]);